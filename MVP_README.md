# py-picToWork MVP 版本使用说明

## 🎉 快速体验版本

这是一个最简化的可运行版本，实现了核心功能：
- ✅ 上传目标图片
- ✅ 屏幕图像识别
- ✅ 自动鼠标点击
- ✅ 实时日志推送

## 🚀 快速启动

### 1. 安装依赖

```bash
cd backend
pip install -r requirements.txt
```

或使用虚拟环境（推荐）：

```bash
cd backend
python3 -m venv venv
source venv/bin/activate  # Windows: venv\Scripts\activate
pip install -r requirements.txt
```

### 2. 启动服务

```bash
python main.py
```

### 3. 打开浏览器

访问：http://localhost:8000

## 📖 使用步骤

### 第一步：准备目标图片

截取你想要点击的按钮或元素的图片：

1. **macOS**: `Cmd + Shift + 4` 截图
2. **Windows**: `Win + Shift + S` 截图
3. 保存为 PNG 或 JPG 格式

**重要提示**：
- 截取的图片要清晰、完整
- 不要包含太多周围内容
- 建议图片大小：50x50 到 300x300 像素

### 第二步：上传并执行

1. 在网页中点击上传区域或拖拽图片
2. 调整置信度（建议 0.7-0.9）
   - 0.7：较宽松，识别率高但可能误识别
   - 0.9：严格匹配，准确但可能找不到
3. 点击"🚀 识别并点击"按钮
4. 观察右侧日志输出

### 第三步：查看结果

系统会：
1. 📸 截取当前屏幕
2. 🔍 在屏幕上查找目标图片
3. 📍 定位到图片中心坐标
4. 🖱️ 移动鼠标并点击
5. 📝 实时推送日志到前端

## 💡 实际使用场景示例

### 场景 1：自动点击"确认"按钮

1. 打开一个包含"确认"按钮的应用
2. 截取"确认"按钮的图片
3. 在 py-picToWork 中上传该图片
4. 点击执行，系统自动点击"确认"

### 场景 2：自动刷新页面

1. 截取浏览器的"刷新"按钮图标
2. 上传图片并执行
3. 系统会自动找到并点击刷新按钮

## ⚙️ 参数说明

### 置信度 (Confidence)

- **含义**: 图像匹配的相似度阈值
- **范围**: 0.0 - 1.0
- **建议值**:
  - 静态按钮：0.85 - 0.95
  - 普通元素：0.75 - 0.85
  - 动态内容：0.65 - 0.75

### 日志级别

- 🔵 **info**: 普通信息
- 🟢 **success**: 操作成功
- 🟡 **warning**: 警告信息
- 🔴 **error**: 错误信息

## 🛠️ 故障排除

### 1. "未找到目标图片"

**可能原因**：
- 置信度设置过高
- 屏幕分辨率不同
- 目标元素外观变化

**解决方案**：
- 降低置信度到 0.7
- 重新截取当前屏幕的目标图片
- 确保目标元素在屏幕上可见

### 2. "WebSocket 未连接"

**解决方案**：
- 刷新页面
- 检查后端服务是否正常运行
- 查看浏览器控制台是否有错误

### 3. macOS 权限问题

如果点击无效，需要授予权限：

1. 打开"系统设置"
2. 进入"隐私与安全性"
3. 选择"辅助功能"
4. 添加"终端"或你的 Python 可执行文件
5. 重启服务

### 4. 点击位置不准确

**解决方案**：
- 确保只使用单个显示器（暂不支持多显示器）
- 检查屏幕缩放设置
- 截取更精确的目标图片

## 📊 技术实现

### 后端技术

- **FastAPI**: Web 框架，提供 API 和 WebSocket
- **OpenCV**: 图像识别，使用模板匹配算法
- **mss**: 高性能屏幕截图
- **PyAutoGUI**: 鼠标键盘控制

### 前端技术

- **原生 HTML/CSS/JavaScript**: 无需额外构建
- **WebSocket**: 实时双向通信
- **FormData API**: 文件上传

### 工作流程

```
用户上传图片
    ↓
前端发送 POST 请求 + 文件
    ↓
后端保存图片
    ↓
截取当前屏幕
    ↓
使用 OpenCV 模板匹配
    ↓
找到最佳匹配位置
    ↓
PyAutoGUI 移动鼠标并点击
    ↓
通过 WebSocket 推送日志
    ↓
前端实时显示结果
```

## 🎯 核心代码说明

### 图像识别算法

使用 OpenCV 的 `cv2.matchTemplate()` 进行模板匹配：

1. 将屏幕截图和模板图片转换为灰度图
2. 使用归一化相关系数法 (`TM_CCOEFF_NORMED`)
3. 找到最大匹配值的位置
4. 如果匹配值 >= 置信度，则识别成功

### 鼠标点击

```python
# 移动到目标位置（带动画）
pyautogui.moveTo(x, y, duration=0.5)

# 等待一小段时间
await asyncio.sleep(0.2)

# 执行点击
pyautogui.click()
```

## 🔒 安全说明

1. **本地运行**: 所有数据都在本地处理，不上传到任何服务器
2. **FAILSAFE**: PyAutoGUI 默认开启，移动鼠标到屏幕角落可停止
3. **权限控制**: 需要系统授权才能控制鼠标键盘

## 📈 性能指标

- **图像识别速度**: 约 100-200ms（取决于屏幕分辨率）
- **鼠标移动时间**: 0.5 秒（可调整）
- **WebSocket 延迟**: < 10ms

## 🚧 当前限制

1. 仅支持单显示器
2. 不支持多尺度匹配（不同分辨率需要重新截图）
3. 不支持工作流编排（一次只执行一个任务）
4. 不支持条件判断和循环

## 🔮 完整版功能

想要更多功能？查看项目完整版：

- 🎨 可视化工作流编辑器
- 🔄 循环和条件判断
- 💾 工作流保存和加载
- 📊 执行历史记录
- 🖥️ 多显示器支持
- 📝 更丰富的操作类型

详见 [README.md](README.md)

## 📞 问题反馈

遇到问题？
1. 查看日志输出
2. 检查故障排除章节
3. 提交 Issue

---

**版本**: MVP 1.0  
**最后更新**: 2025-10-09










